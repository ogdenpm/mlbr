( Recursive Decompiler: Utility words                 W. Ward  )                                                                ( Case statement by Dr. Charles Eaker: Forth Dimensions II/3  ) : CASE          ?COMP   CSP @ SP@ CSP ! 4 ; IMMEDIATE           : OF            4 ?PAIRS                                                        COMPILE OVER COMPILE =                                          COMPILE 0BRANCH HERE 0 ,                                        COMPILE DROP 5 ; IMMEDIATE                      : ENDOF         5 ?PAIRS                                                        COMPILE BRANCH HERE 0 ,                                         SWAP 2 [COMPILE] THEN 4 ; IMMEDIATE             : ENDCASE       4 ?PAIRS COMPILE DROP                                           BEGIN SP@ CSP @ = 0=                                            WHILE 2 [COMPILE] THEN REPEAT                                   CSP ! ; IMMEDIATE                       -->     ( For examples of use see Screen 11                           ) ( Recursive Decompiler: FORTH Dimensions Mar/Apr 1984 W. Ward ) HEX                                                             VARIABLE GIN        ( number to indent )                        VARIABLE BASESAV    ( Save original base )                      VARIABLE KEYSW      ( Continuous or step switch )               VARIABLE RDFEN      ( Recursion fence )                         ' C/L 2- @  CONSTANT CONST.ADR    ( RUN-TIME CFA )              ' BASE 2- @ CONSTANT USERV.ADR    (       "      )              ' GIN 2- @  CONSTANT VAR.ADR      (       "      )              : U.   0 D. ;                                                   : GOV   OVER @ 2+ ;                                             : 2+D   2+ DUP ;                                                : .G@   0 4 D.R GIN @ ;                                         : DIN   CR DUP .G@ SPACES ;                                     : GIN+   CR OVER .G@ 2+D GIN ! SPACES ;                         : MYSELF   LATEST PFA CFA , ; IMMEDIATE   -->                   ( Recursive Decompiler: FORTH Dimensions Mar/Apr 1984 W. Ward ) : GCHKTYP   ( pfa -- f ) ( Check for the following literal    )      CASE    ' LIT       OF 1   ENDOF                                        ' BRANCH    OF 1   ENDOF                                        ' 0BRANCH   OF 1   ENDOF                                        ' <LOOP>    OF 1   ENDOF                                        ' <+LOOP>   OF 1   ENDOF                                        0 SWAP   ( ff return - ENDCASE drops address     )      ENDCASE ;                                                                                                                  : 1KEY   ( pfa -- pfa c )     KEYSW @                                IF   ?TERMINAL IF   ASCII Q                                        ELSE DUP RDFEN @ U<                                             IF BL   ELSE 0D THEN   THEN                                  ELSE KEY                                                        THEN ;   -->                                               ( Recursive Decompiler: FORTH Dimensions Mar/Apr 1984 W. Ward )                                                                 : GCHK   ( pfa -- pfa [altered] )   1   ( true for CASE )          CASE   GOV ' COMPILE   =                                           OF   2+D @ 2+ NFA ID.             ENDOF                            GOV GCHKTYP                                                  OF   2+D @ SPACE U.               ENDOF                       (      GOV ' CLIT =                       )                     ( OF   2+D C@ SPACE . 1-            ENDOF )                          GOV ' <."> =                                                 OF   2+D COUNT TYPE DUP C@ 1- +   ENDOF                            ( endcase will drop unmatched tf )                           ENDCASE   2+   ( increment pfa )                                -2 GIN +! ;                                               : CK:   ( pfa -- pfa f )                                           DUP CFA @ ' : CFA @ = ;   -->                                ( Recursive Decompiler: FORTH Dimensions Mar/Apr 1984  Screen 4)                                                                : DISTYPE   ( nfa -- )                                             DUP C@ 40 AND   ( get 'immediate' bit )                         IF  ." [COMPILE] " ID.                                          ELSE   DUP ID. PFA CFA DUP @                                       CASE   CONST.ADR     OF ." const " EXECUTE U.     ENDOF                VAR.ADR       OF ." var "   EXECUTE @ U.   ENDOF                USERV.ADR     OF ." user "  EXECUTE @ U.   ENDOF                DROP                                                     ENDCASE                                                      THEN ;   -->                                                                                                                                                                                                                                                                                                                 ( Recursive Decompiler: FORTH Dimensions Mar/Apr 1984 W. Ward ) : (GOESINTO)     ( pfa -- )      CK:                               IF   2- DIN ."   :" 2+D NFA C@ 40 AND                              IF   ."  IMMEDIATE"   THEN                                   BEGIN   DUP @ DUP ' EXIT CFA =                                     OVER ' <;CODE> CFA = OR 0=                                   WHILE   ( high level and not yet end of colon definition )         2+ GIN+ DUP NFA DISTYPE                                         1KEY   CASE                                                        ASCII Q OF   SP! BASESAV @ BASE ! QUIT ENDOF ( get out)         0D      OF   MYSELF                    ENDOF ( CReturn)         ASCII U OF   DROP DROP R> DROP -2 GIN +! ENDOF                  DROP ENDCASE GCHK    ( previous case goes up a level )       REPEAT CR                                                       GIN @ 6 + SPACES 2+ NFA ID.                                  THEN DROP ;   -->                                            ( Recursive Decompiler: FORTH Dimensions Mar/Apr 1984 W. Ward  )                                                                : RDCP   ( perform the decompilation )  BASE @ BASESAV ! DECIMAL      -FIND                                                        IF   DROP 0 GIN ! CK:                                              IF   (GOESINTO)                                                 ELSE   NFA DISTYPE                                              THEN                                                         ELSE   ." Not in the dictionary "                               THEN                                                            BASESAV @ BASE ! ;                                                                                                           HERE RDFEN ! DECIMAL                                            0 KEYSW !     ( decompile one step at a time: store '1' for )                 ( continuous decompile - ie. to printer       )   EXIT                                                            ( Recursive Decompiler: FORTH Dimensions Mar/Apr 1984 W. Ward ) Using the recursive decompiler:                                      Type RDCP forth-word (where forth-word is the one to       decompile) to start the decompiler. If the only response is     forth-word, then the word is a primitive. All values are in     decimal: this can be changed by modifying RDCP (screen 15) to   say HEX instead of DECIMAL.                                                                                                          Q     - quits decompiling                                       U     - instantly moves you up one level in decompilation       ENTER - moves you down one level to decompile the last word             showing from the current word's decompilation                                                                           Any other key will move you to the next word in the currentdecompilation.                                                                                                                  ( Recursive Decompiler: FORTH Dimensions Mar/Apr 1984 W. Ward )                                                                      The code for this utility is completely compatible with    FORTHSE4 for MS-DOS; in fact, it's a superset of GOESINTO, the  decompiler resident in that version of the language (as you'll  notice if you load these screens directly into FORTHSE4 - there are a lot of words already in the dictionary). It will also workunchanged in MVP-FORTH, the kernel of FORTHSE4, if the followingword is added:                                                       : ASCII   BL WORD 1+ C@ [COMPILE] LITERAL ;   IMMEDIATE         Finally, the author states that the utility will run in    FORTH-79. To make this possible, change words with pointy       brackets AROUND THE WORD ITSELF to have round brackets instead: for example, <."> will become (."). An easy way to find them is to try loading the screens: your compiler will stumble over the foreign terms.                                                  ( Recursive Decompiler: FORTH Dimensions Mar/Apr 1984 W. Ward  )TO INSTALL THE DECOMPILER                                            For those without any way to transfer data from the regularoperating system to FORTH, the code will have to be copied from a listing into the FORTH screens. For those who have their own  methods of moving CP/M or MS-DOS information into FORTH, use    them - the screens are exactly the size and layout that FORTH   expects.                                                             If you have FORTHSE4, and don't yet realize it, you have a built-in file-to-screens/screens-to-file ability. SEND-SCRNS    will move screens to DOS files, and GET-SCRNS will bring them   back. Both will prompt you for necessary information, so it's   not hard to do it right. (But USE SCRATCH DISKETTES the first   time, and don't forget drive specifiers for the DOS files.)                                                                          (FORTHSE4 is available at Meadowlark: 484-5981)                                                                                (FORTHSE4 is available at Meadowlark: 484-5981)            